<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>COMPILEME — Online C++ Compiler</title>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #f5f5f5;
      color: #1a1a1a;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* ── Header ── */
    header {
      background: #ffffff;
      border-bottom: 1px solid #e0e0e0;
      padding: 14px 24px;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    header h1 { font-size: 17px; font-weight: 700; color: #1a1a1a; letter-spacing: -0.3px; }
    header .badge {
      font-size: 11px; font-weight: 600;
      background: #f0f0f0; color: #666;
      padding: 2px 9px; border-radius: 12px;
      border: 1px solid #e0e0e0;
    }
    header nav { margin-left: auto; }
    header nav a {
      font-size: 13px; color: #555; text-decoration: none;
      padding: 4px 10px; border-radius: 5px;
    }
    header nav a:hover { color: #1a1a1a; background: #f0f0f0; }

    /* ── Main layout ── */
    main {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 16px;
      padding: 24px;
      max-width: 960px;
      width: 100%;
      margin: 0 auto;
    }

    /* ── Section labels ── */
    .label {
      font-size: 11px; font-weight: 600;
      text-transform: uppercase; letter-spacing: 0.6px;
      color: #888; margin-bottom: 7px;
    }

    /* ── Code editor ── */
    #editor {
      width: 100%;
      height: 300px;
      background: #ffffff;
      color: #1a1a1a;
      border: 1px solid #d0d0d0;
      border-radius: 6px;
      padding: 16px;
      font-family: 'SF Mono', 'Fira Code', 'Cascadia Code', Consolas, 'Courier New', monospace;
      font-size: 13.5px;
      line-height: 1.65;
      resize: vertical;
      outline: none;
      tab-size: 4;
      transition: border-color 0.15s;
    }
    #editor:focus { border-color: #555; }

    /* ── Controls bar ── */
    .controls {
      display: flex;
      align-items: center;
      gap: 14px;
    }

    #runBtn {
      display: flex;
      align-items: center;
      gap: 7px;
      background: #1a1a1a;
      color: #fff;
      border: none;
      border-radius: 6px;
      padding: 8px 20px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.15s, opacity 0.15s;
      user-select: none;
    }
    #runBtn:hover:not(:disabled) { background: #333; }
    #runBtn:disabled { opacity: 0.45; cursor: not-allowed; }

    /* spinner shown while loading */
    .spinner {
      display: none;
      width: 13px; height: 13px;
      border: 2px solid rgba(255,255,255,0.3);
      border-top-color: #fff;
      border-radius: 50%;
      animation: spin 0.55s linear infinite;
    }
    #runBtn.loading .spinner { display: block; }
    #runBtn.loading .icon    { display: none; }
    @keyframes spin { to { transform: rotate(360deg); } }

    #statusText {
      font-size: 12px;
      color: #888;
      min-width: 0;
    }

    /* ── Output box ── */
    #output {
      width: 100%;
      min-height: 160px;
      max-height: 420px;
      overflow-y: auto;
      background: #ffffff;
      border: 1px solid #d0d0d0;
      border-radius: 6px;
      padding: 16px;
      font-family: 'SF Mono', 'Fira Code', 'Cascadia Code', Consolas, 'Courier New', monospace;
      font-size: 13px;
      line-height: 1.6;
      white-space: pre-wrap;
      word-break: break-word;
      transition: border-color 0.2s;
    }
    #output.empty   { color: #bbb; }
    #output.success { border-color: #aaa; color: #1a1a1a; }
    #output.error   { border-color: #e00; color: #cc0000; }

    /* ── Footer ── */
    footer {
      text-align: center;
      padding: 14px;
      font-size: 11px;
      color: #aaa;
      border-top: 1px solid #e0e0e0;
    }
  </style>
</head>
<body>

<header>
  <h1>COMPILEME</h1>
  <span class="badge">C++ · Docker Sandboxed</span>
  <nav><a href="/docs">Docs</a></nav>
</header>

<main>
  <!-- Editor -->
  <div>
    <div class="label">Code Editor &mdash; C++</div>
    <textarea id="editor" spellcheck="false" autocomplete="off" autocorrect="off"></textarea>
  </div>

  <!-- Controls -->
  <div class="controls">
    <button id="runBtn" onclick="runCode()">
      <span class="icon">&#9654;</span>
      <span class="spinner"></span>
      Run
    </button>
    <span id="statusText"></span>
  </div>

  <!-- Output -->
  <div>
    <div class="label">Output</div>
    <pre id="output" class="empty">Output will appear here after you click Run.</pre>
  </div>
</main>

<footer>
  Sandboxed via Docker &mdash; gcc:latest &mdash; 2s time limit &mdash; 256 MB memory limit &mdash; no network access
</footer>

<script>
  // ── Default starter code ───────────────────────────────────────────────────
  document.getElementById('editor').value =
`#include <iostream>
using namespace std;

int main() {
    cout << "Hello, World!" << endl;
    return 0;
}`;

  // ── Tab key → 4 spaces ────────────────────────────────────────────────────
  document.getElementById('editor').addEventListener('keydown', (e) => {
    if (e.key !== 'Tab') return;
    e.preventDefault();
    const ta    = e.target;
    const start = ta.selectionStart;
    const end   = ta.selectionEnd;
    ta.value = ta.value.substring(0, start) + '    ' + ta.value.substring(end);
    ta.selectionStart = ta.selectionEnd = start + 4;
  });

  // ── Run ───────────────────────────────────────────────────────────────────
  async function runCode() {
    const code     = document.getElementById('editor').value.trim();
    const outputEl = document.getElementById('output');
    const btn      = document.getElementById('runBtn');
    const status   = document.getElementById('statusText');

    if (!code) {
      outputEl.className  = 'error';
      outputEl.textContent = 'Error: Editor is empty.';
      return;
    }

    // Loading state
    btn.disabled = true;
    btn.classList.add('loading');
    outputEl.className   = '';
    outputEl.textContent = 'Compiling and running inside Docker…';
    status.textContent   = '';

    const t0 = Date.now();

    try {
      const res  = await fetch('/run', {
        method:  'POST',
        headers: { 'Content-Type': 'application/json' },
        body:    JSON.stringify({ code })
      });

      const data    = await res.json();
      const elapsed = ((Date.now() - t0) / 1000).toFixed(2);
      const text    = data.output ?? '(no output)';

      outputEl.textContent = text;
      status.textContent   = `Finished in ${elapsed}s`;

      // Colour the output box based on content
      const isError = /^Error:|error:|Error:/m.test(text);
      outputEl.className = isError ? 'error' : 'success';

    } catch (err) {
      outputEl.textContent = `Network error: ${err.message}`;
      outputEl.className   = 'error';
      status.textContent   = '';
    } finally {
      btn.disabled = false;
      btn.classList.remove('loading');
    }
  }
</script>
</body>
</html>
